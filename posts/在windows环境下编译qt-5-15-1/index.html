<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>在Windows环境下编译Qt-5-15-1 | Qiao</title><meta name=keywords content="Qt"><meta name=description content="自Qt 5.15开始，Qt对于开源用户只提供源码包的下载，不再提供预编译安装包。这一策略或是为了促使更多人购买Qt的商用授权。无论对这一决策的态度如何，自Qt 5.15开始，无论是使用静态库还是动态库，编译Qt都将是一个必不可少的步骤了。
1 源码下载 Qt 5.15.1的下载地址：Qt 5.15.x source packages
也可以从国内的镜像下载，Qt的镜像列表：https://download.qt.io/static/mirrorlist/
下载qt-everywhere-src-5.15.1.zip后解压，这里假定将源码解压到qt5.15.1-src目录。
2 编译环境搭建 在Windows环境下从源码编译安装Qt，除VS开发环境外，还需要先安装Perl和Python。此外，还有一些可选的三方库可以安装，如OpenSSL Toolkit、ICU、ANGLE，这些库可以为Qt提供额外的特性，但并不是必要的，参见Qt官方文档对编译环境的描述：Qt for Windows - Requirements Qt 5.14。
2.1 Visual Studio Qt可以使用VS 2015，VS 2017，VS 2019进行构建。这里选择使用VS 2019，从https://visualstudio.microsoft.com/zh-hans/ 下载安装即可。
2.2 Perl Perl的Windows版本有2种可以下载，分别是ActivePerl和StrawberryPerl。其中ActivePerl需要注册后下载，StrawberryPerl可以直接下载，推荐StrawberryPerl。
StrawberryPerl下载地址：Strawberry Perl for Windows
安装时默认会添加perl到环境变量。安装完成后，可以通过命令行执行perl -v测试环境变量是否安装成功。
2.3 Python 对于Python，Python 2只被qpdf、qwebengine等几个模块需要，如果不需要这几个模块可以只安装Python 3。这里选择只安装Python 3。
在Windows 10下安装Python的注意事项
从Windows 10 2019 五月更新以来，微软试图把 Python 带到 Windows，因此在C:\Users\%USERNAME%\AppData\Local\Microsoft\WindowsApps路径下加入了python.exe、python3.exe几个占位文件。
这几个文件并非真正的python解释器，执行后会弹出Windows Store页面并定位到Python App的详情页。由于这几个文件也处在系统的PATH环境变量内，当用户执行python时有可能会调用占位文件而非实际的python解释器，从而导致运行错误。
可以通过以下步骤关闭该设置：
输入app exec打开Windows的“应用程序别名”界面
关闭为python.exe和python2.exe设置的别名
下载Python：Python Releases for Windows Python.org
安装时选择将Python加入环境变量。可以在命令行内输入python，检查Python解释器是否会运行。
2.4 LLVM 从Qt 5."><meta name=author content="Qiao"><link rel=canonical href=https://tanjoe.github.io/posts/%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%BC%96%E8%AF%91qt-5-15-1/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://tanjoe.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://tanjoe.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://tanjoe.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://tanjoe.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://tanjoe.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>const config={startOnLoad:!0,theme:"forest",themeVariables:{lineColor:"#fafafa"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(void 0,document.querySelectorAll(".language-mermaid"))}</script><meta property="og:title" content="在Windows环境下编译Qt-5-15-1"><meta property="og:description" content="自Qt 5.15开始，Qt对于开源用户只提供源码包的下载，不再提供预编译安装包。这一策略或是为了促使更多人购买Qt的商用授权。无论对这一决策的态度如何，自Qt 5.15开始，无论是使用静态库还是动态库，编译Qt都将是一个必不可少的步骤了。
1 源码下载 Qt 5.15.1的下载地址：Qt 5.15.x source packages
也可以从国内的镜像下载，Qt的镜像列表：https://download.qt.io/static/mirrorlist/
下载qt-everywhere-src-5.15.1.zip后解压，这里假定将源码解压到qt5.15.1-src目录。
2 编译环境搭建 在Windows环境下从源码编译安装Qt，除VS开发环境外，还需要先安装Perl和Python。此外，还有一些可选的三方库可以安装，如OpenSSL Toolkit、ICU、ANGLE，这些库可以为Qt提供额外的特性，但并不是必要的，参见Qt官方文档对编译环境的描述：Qt for Windows - Requirements Qt 5.14。
2.1 Visual Studio Qt可以使用VS 2015，VS 2017，VS 2019进行构建。这里选择使用VS 2019，从https://visualstudio.microsoft.com/zh-hans/ 下载安装即可。
2.2 Perl Perl的Windows版本有2种可以下载，分别是ActivePerl和StrawberryPerl。其中ActivePerl需要注册后下载，StrawberryPerl可以直接下载，推荐StrawberryPerl。
StrawberryPerl下载地址：Strawberry Perl for Windows
安装时默认会添加perl到环境变量。安装完成后，可以通过命令行执行perl -v测试环境变量是否安装成功。
2.3 Python 对于Python，Python 2只被qpdf、qwebengine等几个模块需要，如果不需要这几个模块可以只安装Python 3。这里选择只安装Python 3。
在Windows 10下安装Python的注意事项
从Windows 10 2019 五月更新以来，微软试图把 Python 带到 Windows，因此在C:\Users\%USERNAME%\AppData\Local\Microsoft\WindowsApps路径下加入了python.exe、python3.exe几个占位文件。
这几个文件并非真正的python解释器，执行后会弹出Windows Store页面并定位到Python App的详情页。由于这几个文件也处在系统的PATH环境变量内，当用户执行python时有可能会调用占位文件而非实际的python解释器，从而导致运行错误。
可以通过以下步骤关闭该设置：
输入app exec打开Windows的“应用程序别名”界面
关闭为python.exe和python2.exe设置的别名
下载Python：Python Releases for Windows Python.org
安装时选择将Python加入环境变量。可以在命令行内输入python，检查Python解释器是否会运行。
2.4 LLVM 从Qt 5."><meta property="og:type" content="article"><meta property="og:url" content="https://tanjoe.github.io/posts/%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%BC%96%E8%AF%91qt-5-15-1/"><meta property="og:image" content="https://tanjoe.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-21T15:11:34+00:00"><meta property="article:modified_time" content="2020-09-21T15:11:34+00:00"><meta property="og:site_name" content="Qiao"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tanjoe.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="在Windows环境下编译Qt-5-15-1"><meta name=twitter:description content="自Qt 5.15开始，Qt对于开源用户只提供源码包的下载，不再提供预编译安装包。这一策略或是为了促使更多人购买Qt的商用授权。无论对这一决策的态度如何，自Qt 5.15开始，无论是使用静态库还是动态库，编译Qt都将是一个必不可少的步骤了。
1 源码下载 Qt 5.15.1的下载地址：Qt 5.15.x source packages
也可以从国内的镜像下载，Qt的镜像列表：https://download.qt.io/static/mirrorlist/
下载qt-everywhere-src-5.15.1.zip后解压，这里假定将源码解压到qt5.15.1-src目录。
2 编译环境搭建 在Windows环境下从源码编译安装Qt，除VS开发环境外，还需要先安装Perl和Python。此外，还有一些可选的三方库可以安装，如OpenSSL Toolkit、ICU、ANGLE，这些库可以为Qt提供额外的特性，但并不是必要的，参见Qt官方文档对编译环境的描述：Qt for Windows - Requirements Qt 5.14。
2.1 Visual Studio Qt可以使用VS 2015，VS 2017，VS 2019进行构建。这里选择使用VS 2019，从https://visualstudio.microsoft.com/zh-hans/ 下载安装即可。
2.2 Perl Perl的Windows版本有2种可以下载，分别是ActivePerl和StrawberryPerl。其中ActivePerl需要注册后下载，StrawberryPerl可以直接下载，推荐StrawberryPerl。
StrawberryPerl下载地址：Strawberry Perl for Windows
安装时默认会添加perl到环境变量。安装完成后，可以通过命令行执行perl -v测试环境变量是否安装成功。
2.3 Python 对于Python，Python 2只被qpdf、qwebengine等几个模块需要，如果不需要这几个模块可以只安装Python 3。这里选择只安装Python 3。
在Windows 10下安装Python的注意事项
从Windows 10 2019 五月更新以来，微软试图把 Python 带到 Windows，因此在C:\Users\%USERNAME%\AppData\Local\Microsoft\WindowsApps路径下加入了python.exe、python3.exe几个占位文件。
这几个文件并非真正的python解释器，执行后会弹出Windows Store页面并定位到Python App的详情页。由于这几个文件也处在系统的PATH环境变量内，当用户执行python时有可能会调用占位文件而非实际的python解释器，从而导致运行错误。
可以通过以下步骤关闭该设置：
输入app exec打开Windows的“应用程序别名”界面
关闭为python.exe和python2.exe设置的别名
下载Python：Python Releases for Windows Python.org
安装时选择将Python加入环境变量。可以在命令行内输入python，检查Python解释器是否会运行。
2.4 LLVM 从Qt 5."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tanjoe.github.io/posts/"},{"@type":"ListItem","position":2,"name":"在Windows环境下编译Qt-5-15-1","item":"https://tanjoe.github.io/posts/%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%BC%96%E8%AF%91qt-5-15-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"在Windows环境下编译Qt-5-15-1","name":"在Windows环境下编译Qt-5-15-1","description":"自Qt 5.15开始，Qt对于开源用户只提供源码包的下载，不再提供预编译安装包。这一策略或是为了促使更多人购买Qt的商用授权。无论对这一决策的态度如何，自Qt 5.15开始，无论是使用静态库还是动态库，编译Qt都将是一个必不可少的步骤了。\n1 源码下载 Qt 5.15.1的下载地址：Qt 5.15.x source packages\n也可以从国内的镜像下载，Qt的镜像列表：https://download.qt.io/static/mirrorlist/\n下载qt-everywhere-src-5.15.1.zip后解压，这里假定将源码解压到qt5.15.1-src目录。\n2 编译环境搭建 在Windows环境下从源码编译安装Qt，除VS开发环境外，还需要先安装Perl和Python。此外，还有一些可选的三方库可以安装，如OpenSSL Toolkit、ICU、ANGLE，这些库可以为Qt提供额外的特性，但并不是必要的，参见Qt官方文档对编译环境的描述：Qt for Windows - Requirements Qt 5.14。\n2.1 Visual Studio Qt可以使用VS 2015，VS 2017，VS 2019进行构建。这里选择使用VS 2019，从https://visualstudio.microsoft.com/zh-hans/ 下载安装即可。\n2.2 Perl Perl的Windows版本有2种可以下载，分别是ActivePerl和StrawberryPerl。其中ActivePerl需要注册后下载，StrawberryPerl可以直接下载，推荐StrawberryPerl。\nStrawberryPerl下载地址：Strawberry Perl for Windows\n安装时默认会添加perl到环境变量。安装完成后，可以通过命令行执行perl -v测试环境变量是否安装成功。\n2.3 Python 对于Python，Python 2只被qpdf、qwebengine等几个模块需要，如果不需要这几个模块可以只安装Python 3。这里选择只安装Python 3。\n在Windows 10下安装Python的注意事项\n从Windows 10 2019 五月更新以来，微软试图把 Python 带到 Windows，因此在C:\\Users\\%USERNAME%\\AppData\\Local\\Microsoft\\WindowsApps路径下加入了python.exe、python3.exe几个占位文件。\n这几个文件并非真正的python解释器，执行后会弹出Windows Store页面并定位到Python App的详情页。由于这几个文件也处在系统的PATH环境变量内，当用户执行python时有可能会调用占位文件而非实际的python解释器，从而导致运行错误。\n可以通过以下步骤关闭该设置：\n输入app exec打开Windows的“应用程序别名”界面\n关闭为python.exe和python2.exe设置的别名\n下载Python：Python Releases for Windows Python.org\n安装时选择将Python加入环境变量。可以在命令行内输入python，检查Python解释器是否会运行。\n2.4 LLVM 从Qt 5.","keywords":["Qt"],"articleBody":"自Qt 5.15开始，Qt对于开源用户只提供源码包的下载，不再提供预编译安装包。这一策略或是为了促使更多人购买Qt的商用授权。无论对这一决策的态度如何，自Qt 5.15开始，无论是使用静态库还是动态库，编译Qt都将是一个必不可少的步骤了。\n1 源码下载 Qt 5.15.1的下载地址：Qt 5.15.x source packages\n也可以从国内的镜像下载，Qt的镜像列表：https://download.qt.io/static/mirrorlist/\n下载qt-everywhere-src-5.15.1.zip后解压，这里假定将源码解压到qt5.15.1-src目录。\n2 编译环境搭建 在Windows环境下从源码编译安装Qt，除VS开发环境外，还需要先安装Perl和Python。此外，还有一些可选的三方库可以安装，如OpenSSL Toolkit、ICU、ANGLE，这些库可以为Qt提供额外的特性，但并不是必要的，参见Qt官方文档对编译环境的描述：Qt for Windows - Requirements Qt 5.14。\n2.1 Visual Studio Qt可以使用VS 2015，VS 2017，VS 2019进行构建。这里选择使用VS 2019，从https://visualstudio.microsoft.com/zh-hans/ 下载安装即可。\n2.2 Perl Perl的Windows版本有2种可以下载，分别是ActivePerl和StrawberryPerl。其中ActivePerl需要注册后下载，StrawberryPerl可以直接下载，推荐StrawberryPerl。\nStrawberryPerl下载地址：Strawberry Perl for Windows\n安装时默认会添加perl到环境变量。安装完成后，可以通过命令行执行perl -v测试环境变量是否安装成功。\n2.3 Python 对于Python，Python 2只被qpdf、qwebengine等几个模块需要，如果不需要这几个模块可以只安装Python 3。这里选择只安装Python 3。\n在Windows 10下安装Python的注意事项\n从Windows 10 2019 五月更新以来，微软试图把 Python 带到 Windows，因此在C:\\Users\\%USERNAME%\\AppData\\Local\\Microsoft\\WindowsApps路径下加入了python.exe、python3.exe几个占位文件。\n这几个文件并非真正的python解释器，执行后会弹出Windows Store页面并定位到Python App的详情页。由于这几个文件也处在系统的PATH环境变量内，当用户执行python时有可能会调用占位文件而非实际的python解释器，从而导致运行错误。\n可以通过以下步骤关闭该设置：\n输入app exec打开Windows的“应用程序别名”界面\n关闭为python.exe和python2.exe设置的别名\n下载Python：Python Releases for Windows Python.org\n安装时选择将Python加入环境变量。可以在命令行内输入python，检查Python解释器是否会运行。\n2.4 LLVM 从Qt 5.11开始，QDoc使用Clang来解析C++源码。QDoc是Qt用于生成文档的工具。如果需要构建QDoc，那么需要安装LLVM 6.0以上版本。参见Installing Clang for QDoc。\nLLVM的下载地址：https://releases.llvm.org/download.html\n运行下载的预编译安装包安装LLVM时，建议启用将LLVM加入PATH环境变量的选项，以便让QDoc运行时能链接到libclang.dll。\n注意其它软件安装时可能附带安装了libclang.dll，如doxygen。因此配置PATH变量后建议运行where.exe libclang.dll确认是否能正确找到LLVM的libclang.dll\n此外，由于Windows下的预编译包没有llvm-config.exe文件，需要配置LLVM_INSTALL_DIR环境变量，将其值设为LLVM的安装路径，以便能在编译时找到LLVM。环境变量可以设置到系统内，也可以在命令行内临时设置：\nC:\\\u003e set LLVM_INSTALL_DIR=C:\\Program Files\\LLVM 3 编译Qt Qt源码根路径下有configure脚本文件（该文件的作用与CMake类似，用于生成Makefile），运行该脚本并传入参数即可生成对应的Makefile。在生成Makefile后便可以运行nmake工具执行编译。\n3.1 设置环境变量 编译时我们需要打开MSVC的命令行环境x64 Native Tools Command Prompt for VS 2019，以便使用nmake等工具（如果想编译32位版本的Qt，则可以打开x86 Native Tools Command Prompt for VS 2019）：\n********************************************************************** ** Visual Studio 2019 Developer Command Prompt v16.4.5 ** Copyright (c) 2019 Microsoft Corporation ********************************************************************** [vcvarsall.bat] Environment initialized for: 'x64' C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\u003e 切换到Qt源码路径：\ncd /d D:\\qt5.15.1-src 由于生成的二进制文件如qmake、moc或第三方工具bison、flex等需要参与Qt的编译工作，因此要将这些文件的路径加入环境变量：\nSET _ROOT=D:\\qt5.15.1-src #源码根目录 SET PATH=%_ROOT%\\qtbase\\bin;%_ROOT%\\gnuwin32\\bin;%PATH% 3.2 配置 通过configure脚本可以指定安装位置、要生成的Qt模块、要使用的三方库、编译选项等，详情参见https://doc.qt.io/qt-5/configure-options.html\n一般情况下，指定Qt的安装位置、要使用的配置即可：\nconfigure -prefix \"D:\\qt\" #指明安装的目录 -release #指明使用release配置，也可以切换为-debug或-debug-and-release -opensource #使用开源协议 -confirm-license #接受协议 -mp #编译选项，指明多核编译 随后configure会生成必要的代码，检测编译环境，并列出将生成的Qt的模块。\n3.3 编译 在MSVC环境下，可以使用nmake工具解析Makefile并进行编译。\n新版的MSVC可以进行多线程编译，旧版本的MSVC自带的nmake没有多线程编译功能，有一个替代功能的软件jom可以进行nmake的多线程编译，下载地址：http://download.qt.io/official_releases/jom/\n使用nmake进行编译：\nnmake 或使用jom：\njom #如果jom路径不在PATH环境变量内，则需要指定jom的具体路径 编译完成后，使用nmake或jom安装Qt到指定位置：\nnmake install #jom install 4 生成文档 在Qt 5.15以前，Qt的文档可以通过预编译安装包一起安装，打开Qt Assistant即可使用。在Qt 5.15以后，由于不存在预编译安装包，因此文档也需要单独生成并添加到Qt Assistant内。\nqmake使用QT_INSTALL_DOCS环境变量确定文档的安装位置，可以执行qmake -query检查该设置。\n生成文档：\nnmake docs #jom docs 安装文档：\nnmake install_docs #jom install_docs 注意，在生成文档前，务必确认qdoc工具已生成且能正常运行\n5 安装Qt Creator Qt Creator需要单独安装，有预编译安装包可用：https://www.qt.io/offline-installers\n运行安装包时，需要输入Qt的注册账号和密码。如想跳过这一步，可在Windows的”网络连接“内禁用所有互联网连接。\n注意，在安装了LLVM后，Qt Creator启动时会自动运行lldb --version以确定lldb是否可用。lldb依赖于python36.dll但LLVM的预编译安装包又未附带该文件，这会导致启动Qt Creator时弹出python36.dll无法找到的错误。\n这是LLVM的一个bug，见https://bugs.llvm.org/show_bug.cgi?id=44087 。目前的解决方法是，自行下载python36.dll并放到lldb.exe的同级目录下。当然，如果不再需要LLVM也可以直接卸载。\n","wordCount":"204","inLanguage":"en","datePublished":"2020-09-21T15:11:34Z","dateModified":"2020-09-21T15:11:34Z","author":{"@type":"Person","name":"Qiao"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanjoe.github.io/posts/%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%BC%96%E8%AF%91qt-5-15-1/"},"publisher":{"@type":"Organization","name":"Qiao","logo":{"@type":"ImageObject","url":"https://tanjoe.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tanjoe.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://tanjoe.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tanjoe.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://tanjoe.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tanjoe.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://tanjoe.github.io/posts/>Posts</a></div><h1 class=post-title>在Windows环境下编译Qt-5-15-1</h1><div class=post-meta><span title='2020-09-21 15:11:34 +0000 UTC'>2020-09-21</span>&nbsp;·&nbsp;Qiao</div></header><div class=post-content><p>自Qt 5.15开始，Qt对于开源用户只提供源码包的下载，不再提供预编译安装包。这一策略或是为了促使更多人购买Qt的商用授权。无论对这一决策的态度如何，自Qt 5.15开始，无论是使用静态库还是动态库，编译Qt都将是一个必不可少的步骤了。</p><h2 id=1-源码下载>1 源码下载<a hidden class=anchor aria-hidden=true href=#1-源码下载>#</a></h2><p>Qt 5.15.1的下载地址：<a href=https://www.qt.io/offline-installers>Qt 5.15.x source packages</a></p><p>也可以从国内的镜像下载，Qt的镜像列表：<a href=https://download.qt.io/static/mirrorlist/>https://download.qt.io/static/mirrorlist/</a></p><p>下载<code>qt-everywhere-src-5.15.1.zip</code>后解压，这里假定将源码解压到<code>qt5.15.1-src</code>目录。</p><h2 id=2-编译环境搭建>2 编译环境搭建<a hidden class=anchor aria-hidden=true href=#2-编译环境搭建>#</a></h2><p>在Windows环境下从源码编译安装Qt，除VS开发环境外，还需要先安装Perl和Python。此外，还有一些可选的三方库可以安装，如<a href=http://www.openssl.org/>OpenSSL Toolkit</a>、<a href=http://site.icu-project.org/>ICU</a>、<a href=https://chromium.googlesource.com/angle/angle/+/master/README.md>ANGLE</a>，这些库可以为Qt提供额外的特性，但并不是必要的，参见Qt官方文档对编译环境的描述：<a href=https://doc.qt.io/qt-5/windows-requirements.html#building-from-source>Qt for Windows - Requirements Qt 5.14</a>。</p><h3 id=21-visual-studio>2.1 Visual Studio<a hidden class=anchor aria-hidden=true href=#21-visual-studio>#</a></h3><p>Qt可以使用VS 2015，VS 2017，VS 2019进行构建。这里选择使用VS 2019，从<a href=https://visualstudio.microsoft.com/zh-hans/>https://visualstudio.microsoft.com/zh-hans/</a> 下载安装即可。</p><h3 id=22-perl>2.2 Perl<a hidden class=anchor aria-hidden=true href=#22-perl>#</a></h3><p>Perl的Windows版本有2种可以下载，分别是<code>ActivePerl</code>和<code>StrawberryPerl</code>。其中<code>ActivePerl</code>需要注册后下载，<code>StrawberryPerl</code>可以直接下载，推荐<code>StrawberryPerl</code>。</p><p><code>StrawberryPerl</code>下载地址：<a href=http://strawberryperl.com/>Strawberry Perl for Windows</a></p><p>安装时默认会添加perl到环境变量。安装完成后，可以通过命令行执行<code>perl -v</code>测试环境变量是否安装成功。</p><h3 id=23-python>2.3 Python<a hidden class=anchor aria-hidden=true href=#23-python>#</a></h3><p>对于Python，Python 2只被<code>qpdf</code>、<code>qwebengine</code>等几个模块需要，如果不需要这几个模块可以只安装Python 3。这里选择只安装Python 3。</p><blockquote><p><strong>在Windows 10下安装Python的注意事项</strong></p><p>从Windows 10 2019 五月更新以来，微软试图把 Python 带到 Windows，因此在<code>C:\Users\%USERNAME%\AppData\Local\Microsoft\WindowsApps</code>路径下加入了<code>python.exe</code>、<code>python3.exe</code>几个占位文件。</p><p>这几个文件并非真正的python解释器，执行后会弹出Windows Store页面并定位到Python App的详情页。由于这几个文件也处在系统的PATH环境变量内，当用户执行<code>python</code>时有可能会调用占位文件而非实际的python解释器，从而导致运行错误。</p><p>可以通过以下步骤关闭该设置：</p><ol><li><p>输入<code>app exec</code>打开Windows的“应用程序别名”界面</p><p><img src=/posts/media/win10-python-app-exec.png></p></li><li><p>关闭为<code>python.exe</code>和<code>python2.exe</code>设置的别名</p><p><img src=/posts/media/win10-python-app-exec-ui.png></p></li></ol></blockquote><p>下载Python：<a href=https://www.python.org/downloads/windows/>Python Releases for Windows Python.org</a></p><p>安装时选择将Python加入环境变量。可以在命令行内输入<code>python</code>，检查Python解释器是否会运行。</p><h3 id=24-llvm>2.4 LLVM<a hidden class=anchor aria-hidden=true href=#24-llvm>#</a></h3><p>从Qt 5.11开始，<a href=https://doc.qt.io/qt-5/qdoc-index.html>QDoc</a>使用Clang来解析C++源码。QDoc是Qt用于生成文档的工具。如果需要构建QDoc，那么需要安装LLVM 6.0以上版本。参见<a href=https://doc.qt.io/qt-5/qdoc-guide-clang.html>Installing Clang for QDoc</a>。</p><p>LLVM的下载地址：<a href=https://releases.llvm.org/download.html>https://releases.llvm.org/download.html</a></p><p>运行下载的预编译安装包安装LLVM时，建议启用将LLVM加入PATH环境变量的选项，以便让QDoc运行时能链接到<code>libclang.dll</code>。</p><blockquote><p>注意其它软件安装时可能附带安装了<code>libclang.dll</code>，如doxygen。因此配置PATH变量后建议运行<code>where.exe libclang.dll</code>确认是否能正确找到LLVM的<code>libclang.dll</code></p></blockquote><p>此外，由于Windows下的预编译包没有<code>llvm-config.exe</code>文件，需要配置<code>LLVM_INSTALL_DIR</code>环境变量，将其值设为LLVM的安装路径，以便能在编译时找到LLVM。环境变量可以设置到系统内，也可以在命令行内临时设置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>C:</span><span class=p>\&gt;</span> <span class=nb>set </span><span class=n>LLVM_INSTALL_DIR</span><span class=p>=</span><span class=n>C:</span><span class=p>\</span><span class=n>Program</span> <span class=n>Files</span><span class=p>\</span><span class=n>LLVM</span>
</span></span></code></pre></div><h2 id=3-编译qt>3 编译Qt<a hidden class=anchor aria-hidden=true href=#3-编译qt>#</a></h2><p>Qt源码根路径下有<code>configure</code>脚本文件（该文件的作用与CMake类似，用于生成<code>Makefile</code>），运行该脚本并传入参数即可生成对应的<code>Makefile</code>。在生成<code>Makefile</code>后便可以运行<code>nmake</code>工具执行编译。</p><h3 id=31-设置环境变量>3.1 设置环境变量<a hidden class=anchor aria-hidden=true href=#31-设置环境变量>#</a></h3><p>编译时我们需要打开MSVC的命令行环境<code>x64 Native Tools Command Prompt for VS 2019</code>，以便使用<code>nmake</code>等工具（如果想编译32位版本的Qt，则可以打开<code>x86 Native Tools Command Prompt for VS 2019</code>）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>**********************************************************************</span>
</span></span><span class=line><span class=cl><span class=p>**</span> <span class=n>Visual</span> <span class=n>Studio</span> <span class=mf>2019</span> <span class=n>Developer</span> <span class=n>Command</span> <span class=n>Prompt</span> <span class=n>v16</span><span class=p>.</span><span class=py>4</span><span class=p>.</span><span class=py>5</span>
</span></span><span class=line><span class=cl><span class=p>**</span> <span class=n>Copyright</span> <span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=mf>2019</span> <span class=n>Microsoft</span> <span class=n>Corporation</span>
</span></span><span class=line><span class=cl><span class=p>**********************************************************************</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>vcvarsall.bat</span><span class=p>]</span> <span class=n>Environment</span> <span class=n>initialized</span> <span class=k>for</span><span class=err>:</span> <span class=s1>&#39;x64&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>C:</span><span class=p>\</span><span class=n>Program</span> <span class=n>Files</span> <span class=p>(</span><span class=n>x86</span><span class=p>)\</span><span class=n>Microsoft</span> <span class=n>Visual</span> <span class=n>Studio</span><span class=p>\</span><span class=mf>2019</span><span class=p>\</span><span class=n>Community</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>切换到Qt源码路径：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>cd </span><span class=p>/</span><span class=n>d</span> <span class=n>D:</span><span class=p>\</span><span class=n>qt5</span><span class=p>.</span><span class=py>15</span><span class=p>.</span><span class=mf>1</span><span class=n>-src</span>
</span></span></code></pre></div><p>由于生成的二进制文件如<code>qmake</code>、<code>moc</code>或第三方工具<code>bison</code>、<code>flex</code>等需要参与Qt的编译工作，因此要将这些文件的路径加入环境变量：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>SET </span><span class=n>_ROOT</span><span class=p>=</span><span class=n>D:</span><span class=p>\</span><span class=n>qt5</span><span class=p>.</span><span class=py>15</span><span class=p>.</span><span class=mf>1</span><span class=n>-src</span> <span class=c>#源码根目录</span>
</span></span><span class=line><span class=cl><span class=nb>SET </span><span class=n>PATH</span><span class=p>=</span><span class=k>%</span><span class=n>_ROOT</span><span class=p>%\</span><span class=n>qtbase</span><span class=p>\</span><span class=n>bin</span><span class=p>;</span><span class=k>%</span><span class=n>_ROOT</span><span class=p>%\</span><span class=n>gnuwin32</span><span class=p>\</span><span class=n>bin</span><span class=p>;</span><span class=k>%</span><span class=n>PATH</span><span class=p>%</span>
</span></span></code></pre></div><h3 id=32-配置>3.2 配置<a hidden class=anchor aria-hidden=true href=#32-配置>#</a></h3><p>通过<code>configure</code>脚本可以指定安装位置、要生成的Qt模块、要使用的三方库、编译选项等，详情参见<a href=https://doc.qt.io/qt-5/configure-options.html>https://doc.qt.io/qt-5/configure-options.html</a></p><p>一般情况下，指定Qt的安装位置、要使用的配置即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>configure</span>
</span></span><span class=line><span class=cl><span class=n>-prefix</span> <span class=s2>&#34;D:\qt&#34;</span> <span class=c>#指明安装的目录</span>
</span></span><span class=line><span class=cl><span class=n>-release</span> <span class=c>#指明使用release配置，也可以切换为-debug或-debug-and-release</span>
</span></span><span class=line><span class=cl><span class=n>-opensource</span> <span class=c>#使用开源协议</span>
</span></span><span class=line><span class=cl><span class=n>-confirm-license</span> <span class=c>#接受协议</span>
</span></span><span class=line><span class=cl><span class=n>-mp</span> <span class=c>#编译选项，指明多核编译</span>
</span></span></code></pre></div><p>随后<code>configure</code>会生成必要的代码，检测编译环境，并列出将生成的Qt的模块。</p><h3 id=33-编译>3.3 编译<a hidden class=anchor aria-hidden=true href=#33-编译>#</a></h3><p>在MSVC环境下，可以使用<code>nmake</code>工具解析<code>Makefile</code>并进行编译。</p><p>新版的MSVC可以进行多线程编译，旧版本的MSVC自带的<code>nmake</code>没有多线程编译功能，有一个替代功能的软件<code>jom</code>可以进行<code>nmake</code>的多线程编译，下载地址：<a href=http://download.qt.io/official_releases/jom/>http://download.qt.io/official_releases/jom/</a></p><p>使用<code>nmake</code>进行编译：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>nmake</span>
</span></span></code></pre></div><p>或使用<code>jom</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>jom</span> <span class=c>#如果jom路径不在PATH环境变量内，则需要指定jom的具体路径</span>
</span></span></code></pre></div><p>编译完成后，使用<code>nmake</code>或<code>jom</code>安装Qt到指定位置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>nmake</span> <span class=n>install</span>
</span></span><span class=line><span class=cl><span class=c>#jom install</span>
</span></span></code></pre></div><h2 id=4-生成文档>4 生成文档<a hidden class=anchor aria-hidden=true href=#4-生成文档>#</a></h2><p>在Qt 5.15以前，Qt的文档可以通过预编译安装包一起安装，打开<a href=https://doc.qt.io/qt-5/qtassistant-index.html>Qt Assistant</a>即可使用。在Qt 5.15以后，由于不存在预编译安装包，因此文档也需要单独生成并添加到Qt Assistant内。</p><p><code>qmake</code>使用<code>QT_INSTALL_DOCS</code>环境变量确定文档的安装位置，可以执行<code>qmake -query</code>检查该设置。</p><p>生成文档：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>nmake</span> <span class=n>docs</span>
</span></span><span class=line><span class=cl><span class=c>#jom docs</span>
</span></span></code></pre></div><p>安装文档：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>nmake</span> <span class=n>install_docs</span>
</span></span><span class=line><span class=cl><span class=c>#jom install_docs</span>
</span></span></code></pre></div><blockquote><p>注意，在生成文档前，务必确认<code>qdoc</code>工具已生成且能正常运行</p></blockquote><h2 id=5-安装qt-creator>5 安装Qt Creator<a hidden class=anchor aria-hidden=true href=#5-安装qt-creator>#</a></h2><p>Qt Creator需要单独安装，有预编译安装包可用：<a href=https://www.qt.io/offline-installers>https://www.qt.io/offline-installers</a></p><p>运行安装包时，需要输入Qt的注册账号和密码。如想跳过这一步，可在Windows的”网络连接“内禁用所有互联网连接。</p><blockquote><p>注意，在安装了LLVM后，Qt Creator启动时会自动运行<code>lldb --version</code>以确定<code>lldb</code>是否可用。<code>lldb</code>依赖于<code>python36.dll</code>但LLVM的预编译安装包又未附带该文件，这会导致启动Qt Creator时弹出<code>python36.dll</code>无法找到的错误。</p><p>这是LLVM的一个bug，见<a href="https://bugs.llvm.org/show_bug.cgi?id=44087">https://bugs.llvm.org/show_bug.cgi?id=44087</a> 。目前的解决方法是，自行下载<code>python36.dll</code>并放到<code>lldb.exe</code>的同级目录下。当然，如果不再需要LLVM也可以直接卸载。</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://tanjoe.github.io/tags/qt/>Qt</a></li></ul><nav class=paginav><a class=prev href=https://tanjoe.github.io/posts/%E5%A4%84%E7%90%86%E6%89%98%E7%AE%A1c++%E7%9A%84eefileloadexception/><span class=title>« Prev</span><br><span>处理托管C++的EEFileLoadException</span></a>
<a class=next href=https://tanjoe.github.io/posts/%E5%9C%A8windows%E4%B8%8A%E7%BC%96%E8%AF%91vtk-9-0-1%E5%8F%8A%E5%85%B6%E7%A4%BA%E4%BE%8B/><span class=title>Next »</span><br><span>在Windows上编译VTK-9-0-1及其示例</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://tanjoe.github.io/>Qiao</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>